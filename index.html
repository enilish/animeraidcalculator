
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="color-scheme" content="dark">
<title>Anime Raid Calculator</title>
<style>
  :root{
    --bg2:#5300d6; --bg3:#f6c640;
    --panel:#0e1020cc; --glass:#111321cc;
    --accent:#00e7ff;
    --gold:#f6c640;
  }
  html,body{
    height:100%; margin:0;
    color:#ffffff;
    font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
    background:
      radial-gradient(1200px 600px at 60% 20%, rgba(255,255,255,.08), transparent),
      radial-gradient(900px 500px at 40% 70%, rgba(255,255,255,.06), transparent),
      linear-gradient(180deg, var(--bg2) 0%, #6f00ff 45%, #a700ff 60%, var(--bg3) 100%);
    background-attachment: fixed;
    color-scheme: dark;
    -webkit-text-size-adjust: 100%;
  }
  .wrap{max-width:1100px; margin:24px auto 64px; padding:0 16px;}
  header{display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;}
  .brand{display:flex; align-items:center; gap:12px; font-weight:800; letter-spacing:.3px; font-size:20px; text-shadow:0 0 12px rgba(0,231,255,.5);}
  .brand .dot{width:12px; height:12px; border-radius:50%; background: var(--accent); box-shadow: 0 0 24px var(--accent), 0 0 48px var(--accent);}
  .tabs{display:flex; gap:8px; flex-wrap:wrap; background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.15)); padding:6px; border-radius:999px; border:1px solid rgba(255,255,255,.15);}
  .tab{padding:8px 14px; border-radius:999px; font-weight:600; color:#dbe6ff;}
  .tab.active{color:#07131a; background: linear-gradient(180deg, #c6fbff, #7ef7ff); box-shadow: 0 8px 18px rgba(0,231,255,.35);}
  .panel{background: var(--panel); border: 1px solid rgba(255,255,255,.15); border-radius:18px; box-shadow: 0 12px 60px rgba(0,0,0,.35);}
  .panel .head{display:flex; justify-content:space-between; align-items:center; padding:16px 18px; background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.2));}
  .head .title{display:flex; align-items:center; gap:10px; font-weight:700;}
  .glow{color:#00e7ff; text-shadow:0 0 12px rgba(0,231,255,.6), -1px 0 #000, 0 1px #000, 1px 0 #000, 0 -1px #000;}
  .grid{display:grid; gap:18px; padding:18px;}
  @media (min-width: 860px){ .grid{ grid-template-columns: 360px 1fr; } }
  .card{background: var(--glass); border: 1px solid rgba(255,255,255,.12); border-radius:14px; padding:14px;}
  .card h3{margin:0 0 10px; font-size:14px; font-weight:700; color:#dbe6ff; letter-spacing:.3px;}

  /* FORCE WHITE TEXT EVERYWHERE */
  .field{display:flex; flex-direction:column; gap:6px; margin:10px 0;}
  .field label{font-size:13px; color:#dbe6ff; text-shadow:-1px 0 #000,0 1px #000,1px 0 #000,0 -1px #000;}
  input.input, select{
    width:100%; background:#0b0f1d !important;
    color:#ffffff !important;
    -webkit-text-fill-color:#ffffff !important;
    caret-color:#ffffff;
    border:1px solid rgba(255,255,255,.22); border-radius:10px; padding:12px 12px; font-size:16px; outline:none;
    text-shadow:-1px 0 #000,0 1px #000,1px 0 #000,0 -1px #000;
  }
  input::placeholder{color:#e7efff; opacity:.75; -webkit-text-fill-color:#e7efff;}
  input:-webkit-autofill{
    -webkit-text-fill-color:#ffffff !important;
    box-shadow: 0 0 0 1000px #0b0f1d inset !important;
    -webkit-box-shadow: 0 0 0 1000px #0b0f1d inset !important;
  }
  select option{ background:#0b0f1d; color:#ffffff; }

  .row{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
  .btn{appearance:none; border:0; cursor:pointer; padding:12px 14px; border-radius:12px; font-weight:700; background: linear-gradient(180deg, #ffef9a, #f6c640); color:#422f00; box-shadow: 0 8px 18px rgba(246,198,64,.35);}
  .btn.secondary{background: linear-gradient(180deg, #c6fbff, #7ef7ff); color:#062228; box-shadow: 0 8px 18px rgba(0,231,255,.35);}

  .stats{display:grid; gap:12px;}
  @media (min-width: 540px){ .stats{ grid-template-columns: repeat(3, 1fr); } }
  .stat{background:#0b0f1d; border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:12px;}
  .stat .name{font-size:12px; color:#dbe6ff; text-shadow:-1px 0 #000,0 1px #000,1px 0 #000,0 -1px #000;}
  .stat .value{font-size:20px; font-weight:800; letter-spacing:.3px; margin-top:2px; color:#ffffff !important; -webkit-text-fill-color:#ffffff !important;
    text-shadow:-1px 0 #000,0 1px #000,1px 0 #000,0 -1px #000;}

  /* Star icon container */
  .starbox{
    display:flex; align-items:center; gap:8px;
  }
  #starIcon svg{ filter: drop-shadow(0 0 6px rgba(246,198,64,.5)); }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand"><span class="dot"></span> Anime Raid Calculator</div>
      <div class="tabs">
        <div class="tab active">Unit</div>
        <div class="tab">Skill</div>
        <div class="tab">Ability</div>
        <div class="tab">Ascent</div>
      </div>
    </header>

    <section class="panel">
      <div class="head">
        <div class="title"><span class="glow">Lv. 60</span> <span class="pill" style="display:inline-block; padding:4px 8px; border-radius:999px; background:#0b0f1d; border:1px solid rgba(255,255,255,.12);">Calculator</span></div>
        <div class="starbox">
          <div id="starIcon" aria-label="Target Star"></div>
        </div>
      </div>
      <div class="grid">
        <!-- Inputs -->
        <div class="card">
          <h3>Base Stats</h3>
          <div class="field">
            <label for="hp">HP</label>
            <input id="hp" class="input" type="number" inputmode="decimal" placeholder="e.g., 8710000" />
          </div>
          <div class="field">
            <label for="atk">ATK</label>
            <input id="atk" class="input" type="number" inputmode="decimal" placeholder="e.g., 1150000" />
          </div>
          <div class="field">
            <label for="def">DEF</label>
            <input id="def" class="input" type="number" inputmode="decimal" placeholder="e.g., 73080" />
          </div>

          <div class="row">
            <div class="field">
              <label for="fromStar">Current Star</label>
              <select id="fromStar">
                <option value="0.0">0★</option><option value="0.2">0.2★</option><option value="0.4">0.4★</option><option value="0.6">0.6★</option><option value="0.8">0.8★</option><option value="1.0">1★</option><option value="1.2">1.2★</option><option value="1.4">1.4★</option><option value="1.6">1.6★</option><option value="1.8">1.8★</option><option value="2.0">2★</option><option value="2.2">2.2★</option><option value="2.4">2.4★</option><option value="2.6">2.6★</option><option value="2.8">2.8★</option><option value="3.0">3★</option><option value="3.2">3.2★</option><option value="3.4">3.4★</option><option value="3.6">3.6★</option><option value="3.8">3.8★</option><option value="4.0">4★</option><option value="4.2">4.2★</option>
              </select>
            </div>
            <div class="field">
              <label for="toStar">Target Star</label>
              <select id="toStar">
                <option value="0.0">0★</option><option value="0.2">0.2★</option><option value="0.4">0.4★</option><option value="0.6">0.6★</option><option value="0.8">0.8★ (Dupe 1)</option><option value="1.0">1★</option><option value="1.2">1.2★ (Dupe 2)</option><option value="1.4">1.4★</option><option value="1.6">1.6★ (Dupe 3)</option><option value="1.8">1.8★</option><option value="2.0">2★</option><option value="2.2">2.2★</option><option value="2.4">2.4★</option><option value="2.6">2.6★</option><option value="2.8">2.8★</option><option value="3.0">3★</option><option value="3.2">3.2★</option><option value="3.4">3.4★</option><option value="3.6">3.6★</option><option value="3.8">3.8★</option><option value="4.0">4★</option><option value="4.2">4.2★</option>
              </select>
            </div>
          </div>

          <div class="row" style="margin-top:6px;">
            <button id="calc" class="btn">Calculate</button>
            <button id="reset" class="btn secondary">Reset</button>
          </div>
        </div>

        <!-- Results -->
        <div class="card">
          <h3>Results</h3>
          <div class="stats">
            <div class="stat">
              <div class="name">% Increase</div>
              <div class="value"><span id="pct">—</span></div>
            </div>
            <div class="stat">
              <div class="name">Dupes Needed</div>
              <div class="value"><span id="dupes">—</span></div>
            </div>
            <div class="stat">
              <div class="name">Fragments Needed</div>
              <div class="value"><span id="frags">—</span></div>
            </div>
          </div>

          <div class="stats" style="margin-top:12px;">
            <div class="stat">
              <div class="name">HP</div>
              <div class="value"><span id="hp0">—</span> <span class="arrow">→</span> <span id="hp1" class="glow">—</span></div>
            </div>
            <div class="stat">
              <div class="name">ATK</div>
              <div class="value"><span id="atk0">—</span> <span class="arrow">→</span> <span id="atk1" class="glow">—</span></div>
            </div>
            <div class="stat">
              <div class="name">DEF</div>
              <div class="value"><span id="def0">—</span> <span class="arrow">→</span> <span id="def1" class="glow">—</span></div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <footer>
    <div>Tip: Choose your current and target star. Dupes use cumulative logic; fragments = dupes × 10.</div>
  </footer>

<script>
  // CUMULATIVE dupes to reach each star (from your PDF), and total % bonus
  const STAR = [
    {star:0.0, cum:0,   pct:0},
    {star:0.2, cum:1,   pct:20},
    {star:0.4, cum:2,   pct:36},
    {star:0.6, cum:3,   pct:50},
    {star:0.8, cum:4,   pct:62},
    {star:1.0, cum:6,   pct:73},
    {star:1.2, cum:8,   pct:88},
    {star:1.4, cum:11,  pct:101},
    {star:1.6, cum:14,  pct:112},
    {star:1.8, cum:18,  pct:122},
    {star:2.0, cum:23,  pct:131},
    {star:2.2, cum:30,  pct:145},
    {star:2.4, cum:38,  pct:157},
    {star:2.6, cum:48,  pct:168},
    {star:2.8, cum:59,  pct:178},
    {star:3.0, cum:74,  pct:187},
    {star:3.2, cum:93,  pct:203},
    {star:3.4, cum:116, pct:217},
    {star:3.6, cum:143, pct:229},
    {star:3.8, cum:174, pct:240},
    {star:4.0, cum:215, pct:250},
    {star:4.2, cum:266, pct:259},
  ];
  // === Fragment step costs (as confirmed) ===
  const STEPS = [
    {star:0.2,frag:2},{star:0.4,frag:2},{star:0.6,frag:2},{star:0.8,frag:2},
    {star:1.0,frag:5},{star:1.2,frag:5},{star:1.4,frag:5},{star:1.6,frag:5},{star:1.8,frag:5},
    {star:2.0,frag:15},{star:2.2,frag:15},{star:2.4,frag:15},{star:2.6,frag:15},{star:2.8,frag:15},
    {star:3.0,frag:40},{star:3.2,frag:40},{star:3.4,frag:40},{star:3.6,frag:40},{star:3.8,frag:40},
    {star:4.0,frag:100},{star:4.2,frag:100}
  ];
  function fragmentsBetween(a,b){
    if (b<=a) return 0;
    let sum=0;
    for (const step of STEPS){
      if (step.star>a && step.star<=b) sum += step.frag;
    }
    return sum;
  }


  function find(v){ return STAR.find(s => s.star === v) || STAR[0]; }

  const dd = (n)=>{
    if(Number.isNaN(n) || !isFinite(n)) return "—";
    if(Math.abs(n) >= 1e9) return (n/1e9).toFixed(2)+"B";
    if(Math.abs(n) >= 1e6) return (n/1e6).toFixed(2)+"M";
    if(Math.abs(n) >= 1e3) return (n/1e3).toFixed(2)+"K";
    return n.toLocaleString();
  };

  function starSVG(full, frac){
    // Render up to 5 stars total for layout, but we only need 4.x
    const N = 5;
    const size = 22;
    const gap = 6;
    const totalW = N*size + (N-1)*gap;
    let x = 0;
    let svg = `<svg width="${totalW}" height="${size}" viewBox="0 0 ${totalW} ${size}" xmlns="http://www.w3.org/2000/svg">`;
    const path = "M10 1.5 L12.9 7.8 L19.8 8.3 L14.6 12.7 L16.2 19.5 L10 15.8 L3.8 19.5 L5.4 12.7 L0.2 8.3 L7.1 7.8 Z";
    for(let i=0;i<N;i++){
      const tx = i*(size+gap);
      // base outline
      svg += `<g transform="translate(${tx},0)">
                <path d="${path}" fill="#1a1d2b" stroke="#444b66" stroke-width="1.2"/>`;
      if(i < full){
        svg += `<clipPath id="clip${i}"><rect x="0" y="0" width="${size}" height="${size}"/></clipPath>
                <path d="${path}" fill="url(#grad${i})" clip-path="url(#clip${i})"/>`;
      } else if(i === full && frac > 0){
        const w = size * frac;
        svg += `<clipPath id="clip${i}"><rect x="0" y="0" width="${w}" height="${size}"/></clipPath>
                <path d="${path}" fill="url(#grad${i})" clip-path="url(#clip${i})"/>`;
      }
      svg += `</g>`;
    }
    // single gold gradient def reused (ids per star index)
    svg += `<defs>`;
    for(let i=0;i<N;i++){
      svg += `<linearGradient id="grad${i}" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="#ffe68a"/>
                <stop offset="100%" stop-color="#f6c640"/>
              </linearGradient>`;
    }
    svg += `</defs></svg>`;
    return svg;
  }

  function updateStarIcon(){
    const s1 = parseFloat(document.getElementById('toStar').value);
    const full = Math.floor(s1);
    let frac = Math.max(0, s1 - full); // 0..0.9
    // normalize quarter star increments (0,.2,.4,.6,.8)
    const steps = [0, .2, .4, .6, .8, 1.0];
    let nearest = steps.reduce((a,b)=> Math.abs(b-frac) < Math.abs(a-frac) ? b : a, 0);
    if(nearest > 0.999) { nearest = 0; } // shouldn't happen for 4.2 max
    const icon = starSVG(full, nearest);
    document.getElementById('starIcon').innerHTML = icon;
  }

  
function compute(){
    const hp = parseFloat(document.getElementById('hp').value || "0");
    const atk = parseFloat(document.getElementById('atk').value || "0");
    const df  = parseFloat(document.getElementById('def').value || "0");
    const s0  = parseFloat(document.getElementById('fromStar').value);
    const s1  = parseFloat(document.getElementById('toStar').value);

    const P0 = find(s0).pct;
    const P1 = find(s1).pct;
    const deltaPct = Math.max(0, P1 - P0);

    // New: fragment math by step costs (1 dupe = 10 frags)
    const frags = fragmentsBetween(s0, s1);
    const dupes = Math.ceil(frags / 10);

    const mult = 1 + (deltaPct/100);
    const hp1 = hp * mult, atk1 = atk * mult, df1 = df * mult;

    document.getElementById('pct').textContent = `${deltaPct}%`;
    document.getElementById('dupes').textContent = dupes;
    document.getElementById('frags').textContent = (function(n){
      if(!isFinite(n)) return "—";
      if(Math.abs(n)>=1e9) return (n/1e9).toFixed(2)+"B";
      if(Math.abs(n)>=1e6) return (n/1e6).toFixed(2)+"M";
      if(Math.abs(n)>=1e3) return (n/1e3).toFixed(2)+"K";
      return n.toLocaleString();
    })(frags);

    document.getElementById('hp0').textContent = hp.toLocaleString();
    document.getElementById('atk0').textContent= atk.toLocaleString();
    document.getElementById('def0').textContent= df.toLocaleString();
    document.getElementById('hp1').textContent = hp1.toLocaleString();
    document.getElementById('atk1').textContent= atk1.toLocaleString();
    document.getElementById('def1').textContent= df1.toLocaleString();

    if (typeof updateStarIcon === 'function') updateStarIcon();
}
%`;
    document.getElementById('dupes').textContent = dupes;
    document.getElementById('frags').textContent = dd(frags);

    document.getElementById('hp0').textContent = dd(hp);
    document.getElementById('atk0').textContent = dd(atk);
    document.getElementById('def0').textContent = dd(df);
    document.getElementById('hp1').textContent = dd(hp1);
    document.getElementById('atk1').textContent = dd(atk1);
    document.getElementById('def1').textContent = dd(df1);

    updateStarIcon();
  }

  function resetAll(){
    ['hp','atk','def'].forEach(id=>document.getElementById(id).value="");
    document.getElementById('fromStar').value="1.0";
    document.getElementById('toStar').value="2.0";
    ['pct','dupes','frags','hp0','atk0','def0','hp1','atk1','def1'].forEach(id=>document.getElementById(id).textContent='—');
    updateStarIcon();
  }

  document.getElementById('calc').addEventListener('click', compute);
  document.getElementById('reset').addEventListener('click', resetAll);
  document.getElementById('toStar').addEventListener('change', updateStarIcon);
  updateStarIcon();

// Safe binder to ensure compute() runs
(function(){
  function safe(){ try{ compute(); }catch(e){} }
  var btn=document.getElementById('calc'); if(btn) btn.addEventListener('click', safe);
  var rst=document.getElementById('reset'); if(rst) rst.addEventListener('click', function(){
    ['hp','atk','def'].forEach(id=>{var el=document.getElementById(id); if(el) el.value="";});
    var fs=document.getElementById('fromStar'); if(fs) fs.value="0.0";
    var ts=document.getElementById('toStar');   if(ts) ts.value="0.0";
    safe();
  });
  ['hp','atk','def','fromStar','toStar'].forEach(function(id){
    var el=document.getElementById(id); if(!el) return;
    el.addEventListener('input', safe);
    el.addEventListener('change', safe);
  });
  safe();
})();

</script>
</body>
</html>
